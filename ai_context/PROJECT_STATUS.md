# SimpleTrade 项目状态

**最后更新**: 2024-04-17

## 项目概述
SimpleTrade是一个为个人投资者设计的、易于上手的量化与实盘交易平台，采用Web界面交互，提供精选策略、便捷的回测与实盘对接，并通过内置数据服务和特色策略简化用户操作。

**核心特色**：策略参数调整、回测和实盘交易一体化设计，用户可以在同一界面中无缝切换不同阶段，大幅提高策略优化和实盘执行的效率。

## 当前阶段
规划与设计 -> [当前] **需求重定义与前端原型设计** -> 核心功能开发 -> 扩展功能开发 -> 测试与优化 -> 部署上线

## 已完成工作 (基础部分)
- ✅ 项目整体初步规划与架构设计 (旧版，部分可参考)
- ✅ 核心文档编写 (部分过时，需要更新)
- ✅ 项目名称确定为 "SimpleTrade"
- ✅ 创建独立项目结构
- ✅ 初始化Git仓库
- ✅ Conda 环境 (`simpletrade`) 配置基础
- ✅ 老虎证券 Gateway (`vnpy_tiger`) 的初步集成与测试 (代码位于 `vendors/`)
- ✅ 基础 Web 前端框架 (Vue.js) 搭建
- ✅ **前端原型设计与开发:**
    - 清理旧前端代码
    - 搭建应用导航与主布局
    - 开发策略中心页面 (策略库、策略构建器、我的策略)
      - **实现策略参数调整、回测和实盘交易一体化的界面设计**
      - **设计参数优化和策略比较功能界面**
      - **重构策略中心，实现新的层次化结构，包括基础策略、高级策略和组件库**
      - **增强策略卡片，添加复杂度和资源需求指示器**
      - **将策略详情从弹出框改为独立完整页面，以便更详细地展示复杂策略内容**
    - 开发交易中心页面 (账户概览、持仓、订单)
      - **与策略中心无缝集成，支持策略交易的实时监控和管理**
    - 开发 AI 分析中心页面 (市场分析、股票预测、模型训练)
    - 开发用户中心页面 (个人资料、账户设置、订阅管理)
    - **采用Element UI框架实现专业、美观的量化交易界面**

## 进行中工作
- 🔄 更新项目核心文档 (`PROJECT_STATUS.md`, `CURRENT_FOCUS.md`, `DECISIONS_LOG.md`) 以反映新方向。

## 待开始工作 (新需求驱动)
- ⏳ **数据中心 (Data Hub) 开发 (后端):**
    - 设计并实现 PostgreSQL + TimescaleDB 数据库模型用于存储规范化行情数据。
    - **实现数据导入器，支持从 CSV 和本地 Qlib 数据集导入历史数据。**
    - **实现数据转换层，将数据库数据按需转换为 Qlib 格式。**
    - 实现数据更新和管理逻辑。
    - 提供内部数据访问 API (FastAPI)。
    - (可选) 集成 Gateway 进行补充性历史数据下载。
- ⏳ **策略中心 (Strategy Center) 开发 (后端):**
    - 实现策略（vnpy CTA, Qlib AI）的加载、配置与回测逻辑。
    - 对接数据中心获取回测数据。
    - 设计并实现策略存储。
    - **实现策略参数调整、回测和实盘交易的一体化流程，允许用户在同一界面中完成全部操作。**
    - **提供策略参数自动优化功能，帮助用户快速找到最优参数组合。**
- ⏳ **交易中心 (Trading Center) 开发 (后端):**
    - 对接 Tiger Gateway 实现模拟交易和实盘交易执行。
    - 实现账户信息管理（资产、持仓、订单）。
- ⏳ **AI 分析中心 (后端):**
    - 集成 Qlib，实现基于平台数据的模型训练和分析功能。
- ⏳ **后端 API 服务重构:**
    - 根据新的模块划分设计和实现 API 接口。
- ⏳ 数据库模型设计与实现。
- ⏳ 单元测试与集成测试。

## 技术栈 (规划中)
- 后端: Python, FastAPI
- 核心引擎/交易: 利用 vnpy 库 (标准安装，除了 `vnpy_tiger`)
- 数据库: PostgreSQL + TimescaleDB (或其他时序数据库)
- 数据处理: Pandas, NumPy
- AI: Qlib, Scikit-learn, PyTorch/TensorFlow
- 前端: Vue.js
- 环境管理: Conda (`simpletrade` 环境)
- **特殊组件**: 自定义 `vnpy_tiger` (存放于 `vendors/` 目录)

## 关键决策
1.  采用插件架构扩展 vnpy 功能 (思路保留)。
2.  **[新]** 优先开发 Web 前端 (Vue.js)。
3.  项目名称确定为 "SimpleTrade"。
4.  采用结构化项目状态文件方法管理 AI 协作。
5.  **[新]** 数据管理对用户透明化，平台内置数据服务 (初期美股)。
6.  使用 conda 环境来管理项目依赖。
7.  **[新]** 标准库安装 `vnpy` 及其官方插件，自定义 `vnpy_tiger` 保留在 `vendors/` 并通过 `sys.path` 加载。
8.  **[新]** 策略中心重点支持 vnpy CTA 策略模板和 Qlib AI 策略集成。
9.  **[新]** **开发流程调整: 优先进行前端原型改造，用于需求确认，再进行后端开发。**
10. **[新]** **核心设计理念: 策略参数调整、回测和实盘交易一体化，实现无缝切换和高效率的策略优化流程。**
11. **[新]** **采用Element UI框架实现专业、美观的量化交易界面。**

## 最近会话
- [旧会话记录] ...
- [2024-04-13 09:00] 决策变更: 放弃使用 `vnpy` 源码集成方式，改为标准库安装，以简化依赖管理。
- [2024-04-13 11:30] 决策调整: 确认 `vnpy_tiger` 无法通过 `pip` 安装，决定将其源码保留在 `vendors/` 目录，并通过修改 `sys.path` 加载。
- [2024-04-14 10:00] **需求重大调整:** 重新定义平台为内置数据、聚焦策略易用性与实盘交易的个人理财平台。明确数据中心、策略中心（含vnpy CTA、Qlib AI）、交易中心、AI分析中心的核心模块。确定初期优先覆盖美股数据。
- [2024-04-14 14:00] **开发策略调整:** 决定暂停后端开发，优先改造前端界面原型，用于需求确认。
- [2024-04-16 09:00] **前端原型开发完成:** 完成了策略中心、交易中心、AI分析中心和用户中心的前端原型开发，包括各个模块的子页面和交互功能。
- [2024-04-16 15:00] **实现策略一体化设计:** 实现了策略参数调整、回测和实盘交易的一体化界面，包含策略详情对话框、参数优化功能和实盘部署功能。
- [2024-04-15 10:00] **前端界面优化:** 移除了主布局中的API状态显示区域，改善了用户界面。计划将策略详情从弹出框改为独立完整页面，以便更好地展示复杂策略内容。
- [2024-04-15 11:00] **长期规划文档创建:** 创建了长期规划路线图文档，记录了集成n8n、dify和coze等开源项目的创新应用场景，作为未来发展方向。
- [2024-04-17 09:00] **策略中心重构:** 重构了策略中心，实现了新的层次化结构，包括基础策略、高级策略和组件库。增强了策略卡片，添加了复杂度和资源需求指示器。
- [2024-04-17 10:30] **策略详情页面实现:** 完成了策略详情独立页面的开发，替代了原来的弹出框形式，使用户可以更详细地查看复杂策略的内容。
- [2024-04-17 11:30] **标签嵌套问题:** 在重构策略中心过程中发现了StrategyCenterView.vue文件中的标签嵌套问题，需要修复。
- [2024-04-17 14:30] **标签嵌套问题修复:** 成功修复了StrategyCenterView.vue文件中的标签嵌套问题，并修复了复杂度评分组件中的v-model语法错误。
- [2024-04-17 16:00] **策略卡片样式统一:** 统一了策略卡片的结构和样式，确保所有卡片具有一致的高度、布局和元素结构，解决了卡片大小不一和对齐问题。

## 未完成工作和遇到的问题

### [前端标签嵌套问题] - 已解决
- **问题描述**: 在重构策略中心过程中发现StrategyCenterView.vue文件中的标签嵌套问题，导致页面无法正常编译和显示。
- **解决方案**: 重新组织标签页的结构，确保标签正确闭合。修复复杂度评分组件中的v-model语法错误。
- **状态**: **已解决**

### [需求与设计]
- **问题描述**: 项目需求发生重大调整，需根据新设计重新规划开发任务和技术细节。
- **状态**: **进行中 (前端原型设计已完成，正在进行前端优化)**

### [核心问题] Tiger Gateway 配置问题
- **问题描述**: 使用 Tiger Gateway 下载数据时遇到私钥格式或账户权限问题（如美国市场无权限）。
- **状态**: **暂时搁置 (待交易中心后端开发时再重新处理)**
- **下一步**: 在开发交易中心时，需要确认老虎证券账户的市场权限，或使用模拟账户进行开发。

### [环境依赖管理冲突风险]
- **问题描述**: 项目混合使用 `conda` 管理环境，`pip` 可能用于安装 `conda` 源缺失的依赖 (如 `tigeropen`)，并手动管理 `vendors/vnpy_tiger`。需注意潜在冲突。
- **解决方案**: 明确记录安装步骤和依赖来源。
- **状态**: **待观察**

### [待评估] Qlib 集成复杂度
- **问题描述**: 将 Qlib 集成到现有平台，需要适配数据格式、协调训练/回测流程，具体复杂度待评估。
- **状态**: **待评估**

## 下一步计划
1.  **[已完成]** **修复StrategyCenterView.vue文件中的标签嵌套问题:**
    - 重新组织标签页的结构，确保标签正确闭合 [已完成]
    - 修复组件库标签页中的嵌套标签问题 [已完成]
    - 修复复杂度评分组件中的v-model语法错误 [已完成]

2.  **[当前最优先]** **启动前端和后端服务，进行集成测试:**
    - 启动前端服务，测试策略中心重构后的功能
    - 启动后端服务，测试API接口
    - 测试前后端数据交互

3.  **[已完成]** **实现策略详情独立页面:**
    - 创建策略详情页面组件 (StrategyDetailView.vue) [已完成]
    - 在路由中添加新的路由配置 [已完成]
    - 修改策略卡片中的"查看详情"按钮，使其跳转到详情页面 [已完成]
    - 设计详情页面的布局和内容，包含策略信息、回测、参数优化和实盘交易四个模块 [已完成]
4.  **与用户分享前端原型，收集反馈:**
    - 展示策略中心重构后的功能
    - 展示策略详情页面
    - 收集用户对基础策略和高级策略分类的反馈
5.  **基于前端原型，与用户确认最终需求细节。**
6.  **实现数据中心(Data Hub)后端:**
    - 设计并实现PostgreSQL + TimescaleDB数据库模型用于存储规范化行情数据
    - 实现数据导入器，支持从 CSV 和本地 Qlib 数据集导入历史数据
    - 实现数据转换层，将数据库数据按需转换为 Qlib 格式
    - 实现数据更新和管理逻辑
7.  分阶段进行后端开发 (数据中心 -> 策略中心核心 -> 交易中心核心 -> ...)。
