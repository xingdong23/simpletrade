# SimpleTrade 当前状态

**最后更新**: 2024-04-18 00:15

## 项目阶段
规划与设计 -> [当前] **需求重定义与前端原型设计** -> 核心功能开发 -> 扩展功能开发 -> 测试与优化 -> 部署上线

## 项目概述
SimpleTrade是一个为个人投资者设计的、易于上手的量化与实盘交易平台，采用Web界面交互，提供精选策略、便捷的回测与实盘对接，并通过内置数据服务和特色策略简化用户操作。

**核心特色**：策略参数调整、回测和实盘交易一体化设计，用户可以在同一界面中无缝切换不同阶段，大幅提高策略优化和实盘执行的效率。

## 技术栈
- 后端: Python, FastAPI
- 核心引擎/交易: 利用 vnpy 库 (标准安装，除了 `vnpy_tiger`)
- 数据库: PostgreSQL + TimescaleDB (或其他时序数据库)
- 数据处理: Pandas, NumPy
- AI: Qlib, Scikit-learn, PyTorch/TensorFlow
- 前端: Vue.js + Element UI
- 环境管理: Conda (`simpletrade` 环境)
- **特殊组件**: 自定义 `vnpy_tiger` (存放于 `vendors/` 目录)

## 已完成工作
- ✅ 项目整体初步规划与架构设计
- ✅ 项目名称确定为 "SimpleTrade"
- ✅ 创建独立项目结构
- ✅ 初始化Git仓库
- ✅ Conda 环境 (`simpletrade`) 配置基础
- ✅ 老虎证券 Gateway (`vnpy_tiger`) 的初步集成与测试 (代码位于 `vendors/`)
- ✅ 基础 Web 前端框架 (Vue.js) 搭建
- ✅ **前端原型设计与开发:**
    - 清理旧前端代码
    - 搭建应用导航与主布局
    - 开发策略中心页面 (策略库、策略构建器、我的策略)
      - **实现策略参数调整、回测和实盘交易一体化的界面设计**
      - **设计参数优化和策略比较功能界面**
      - **重构策略中心，实现新的层次化结构，包括基础策略、高级策略和组件库**
      - **增强策略卡片，添加复杂度和资源需求指示器**
      - **将策略详情从弹出框改为独立完整页面，以便更详细地展示复杂策略内容**
    - 开发交易中心页面 (账户概览、持仓、订单)
      - **与策略中心无缝集成，支持策略交易的实时监控和管理**
    - 开发 AI 分析中心页面 (市场分析、股票预测、模型训练)
    - 开发用户中心页面 (个人资料、账户设置、订阅管理)
    - **采用Element UI框架实现专业、美观的量化交易界面**
- ✅ 修复StrategyCenterView.vue文件中的标签嵌套问题
- ✅ 实现策略详情独立页面
- ✅ 修夌 talib 与 vnpy 兼容性问题，解决 `symbol not found in flat namespace '_TA_ACCBANDS'` 错误

## 进行中工作
- 🔄 **前端与后端集成测试** (优先级: 高)
    - 启动前端服务，测试策略中心重构后的功能
    - 启动后端服务，测试API接口
    - 测试前后端数据交互
    - 进度: 计划中
- 🔄 **前端界面优化** (优先级: 中)
    - 移除主布局中的API状态显示区域 [已完成]
    - 将策略详情从弹出框改为独立完整页面 [已完成]
    - 重构策略中心，实现新的层次化结构 [已完成]
    - 增强策略卡片，添加复杂度和资源需求指示器 [已完成]
    - 进度: 90%
- 🔄 **项目文档更新** (优先级: 中)
    - 更新核心 AI 协作文档 [进行中]
    - 创建长期规划路线图文档 [已完成]
    - 进度: 70%

## 待开始工作
- ⏳ **数据中心 (Data Hub) 开发 (后端):**
    - 设计并实现 PostgreSQL + TimescaleDB 数据库模型用于存储规范化行情数据
    - 实现数据导入器，支持从 CSV 和本地 Qlib 数据集导入历史数据
    - 实现数据转换层，将数据库数据按需转换为 Qlib 格式
    - 实现数据更新和管理逻辑
    - 提供内部数据访问 API (FastAPI)
- ⏳ **策略中心 (Strategy Center) 开发 (后端):**
    - 实现策略（vnpy CTA, Qlib AI）的加载、配置与回测逻辑
    - 对接数据中心获取回测数据
    - 设计并实现策略存储
    - 实现策略参数调整、回测和实盘交易的一体化流程
    - 提供策略参数自动优化功能
- ⏳ **交易中心 (Trading Center) 开发 (后端):**
    - 对接 Tiger Gateway 实现模拟交易和实盘交易执行
    - 实现账户信息管理（资产、持仓、订单）
- ⏳ **AI 分析中心 (后端):**
    - 集成 Qlib，实现基于平台数据的模型训练和分析功能

## 遇到的问题

### [前端标签嵌套问题] - 已解决
- **问题描述**: 在重构策略中心过程中发现StrategyCenterView.vue文件中的标签嵌套问题，导致页面无法正常编译和显示。
- **解决方案**: 重新组织标签页的结构，确保标签正确闭合。修复复杂度评分组件中的v-model语法错误。
- **状态**: **已解决**

### [需求与设计]
- **问题描述**: 项目需求发生重大调整，需根据新设计重新规划开发任务和技术细节。
- **状态**: **进行中 (前端原型设计已完成，正在进行前端优化)**

### [核心问题] Tiger Gateway 配置问题 - 已解决
- **问题描述**: 使用 Tiger Gateway 下载数据时遇到私钥格式或账户权限问题（如美国市场无权限）。
- **解决方案**: 已解决配置问题，可以正常使用Tiger Gateway。
- **状态**: **已解决**

### [环境依赖管理冲突风险] - 已解决
- **问题描述**: 项目混合使用 `conda` 管理环境，`pip` 可能用于安装 `conda` 源缺失的依赖 (如 `tigeropen`)，并手动管理 `vendors/vnpy_tiger`。
- **解决方案**: 已解决环境依赖管理问题，环境配置稳定。
- **状态**: **已解决**

### [已解决] talib与vnpy兼容性问题
- **问题描述**: 在启动后端服务时，遇到talib库相关的符号加载错误：`symbol not found in flat namespace '_TA_ACCBANDS'`。这个错误导致API路由无法正确注册，影响了后端服务的正常运行。问题可能是由于系统TA-Lib库（0.4.0）与Python ta-lib包（0.6.3）版本不匹配导致的。
- **解决方案**:
  1. 卸载旧版本的 ta-lib Python 包：`conda run -n simpletrade pip uninstall -y ta-lib`
  2. 重新安装 ta-lib 0.6.3 版本：`conda run -n simpletrade pip install ta-lib`
  3. 以开发模式安装 simpletrade 包：`conda run -n simpletrade pip install -e .`
     - 开发模式安装（`pip install -e .`）不会复制代码，而是在 Python 的 site-packages 目录中创建一个指向原始代码位置的链接
     - 这解决了 Python 路径和模块导入问题，使 Python 可以正确找到 `simpletrade.api` 模块
     - 开发者仍然可以直接在源码目录中开发，所有的修改都会立即生效
  4. 使用新的启动命令启动服务器：`conda run -n simpletrade python -m uvicorn simpletrade.api.server:app --host 0.0.0.0 --port 8002 --reload`
     - 注意端口从原来的 8000 改为 8002，以避免端口冲突
- **状态**: **已解决**

### [待评估] Qlib 集成复杂度
- **问题描述**: 将 Qlib 集成到现有平台，需要适配数据格式、协调训练/回测流程，具体复杂度待评估。Qlib主要用于机器学习策略部分。
- **状态**: **待评估**

## 下一步计划
1. **[当前最优先]** **进行前后端集成测试:**
   - 使用已启动的后端服务器（端口 8002）测试前后端数据交互
   - 测试策略中心重构后的功能
   - 测试分析 API 功能，包括技术指标计算和策略回测

2. **与用户分享前端原型，收集反馈:**
   - 展示策略中心重构后的功能
   - 展示策略详情页面
   - 收集用户对基础策略和高级策略分类的反馈

3. **基于前端原型，与用户确认最终需求细节。**

4. **实现数据中心(Data Hub)后端:**
   - 设计并实现PostgreSQL + TimescaleDB数据库模型用于存储规范化行情数据
   - 实现数据导入器，支持从 CSV 和本地 Qlib 数据集导入历史数据
   - 实现数据转换层，将数据库数据按需转换为 Qlib 格式
   - 实现数据更新和管理逻辑

5. 分阶段进行后端开发 (数据中心 -> 策略中心核心 -> 交易中心核心 -> ...)

## 最近更新
- [2024-04-18 00:15]: 详细记录开发模式安装的优势和启动命令的变化
- [2024-04-17 23:45]: 修复 talib 与 vnpy 兼容性问题，成功启动后端服务器，包括依赖 talib 和 vnpy 的功能
- [2024-04-17 23:00]: 记录talib与vnpy兼容性问题，并添加了临时解决方案
- [2024-04-17 22:30]: 在前后端集成测试中发现talib库相关的符号加载错误，影响API路由注册
- [2024-04-17 17:30]: 更新Tiger Gateway配置问题和环境依赖管理冲突风险为已解决状态，更新Qlib集成复杂度描述
- [2024-04-17 16:30]: 更新项目状态文档，修复时间错误，确保下一步计划与最新的数据中心设计决策保持一致
- [2024-04-17 16:00]: 统一策略卡片的结构和样式，确保所有卡片具有一致的高度、布局和元素结构
- [2024-04-17 14:30]: 修复StrategyCenterView.vue文件中的标签嵌套问题和复杂度评分组件中的v-model语法错误
- [2024-04-17 11:30]: 发现StrategyCenterView.vue文件中的标签嵌套问题，需要修复
- [2024-04-17 10:30]: 完成策略详情独立页面的开发，替代原来的弹出框形式
- [2024-04-17 09:30]: 确定数据中心设计方案，包括历史数据导入与Qlib兼容性
- [2024-04-17 09:00]: 重构策略中心，实现新的层次化结构，包括基础策略、高级策略和组件库
